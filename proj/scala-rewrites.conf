// https://github.com/scala/scala-rewrites.git#master

// This project is unusual in that we build it using only binary
// dependencies, since the community build's scalafix version is too
// old and we can't upgrade it because it has too many dependencies.
// (And scala-rewrites is 2.12-only because it lives in
// sbt-plugin-land.)

// This is trickier-than-normal because semanticdb-scalac and
// scalafix-testkit are CrossVersion.full, so we have to override that
// to use older binaries, since binaries don't exist for Scala nightlies.
//
// (If those older binaries don't work, then we'll have to do
// something else, but in a way that's good because we can notify Olaf
// upstream that we changed something in Scala that's going to require
// changes to Scalafix.)
//
// Note the hardcoded version numbers below (2.12.11, 4.3.8, 0.9.15).
// They may need bumping when a new Scala 2.12.x release is published
// or when we advance the scala-rewrites SHA.  Maybe it's possible to
// somehow avoid that by computing the version numbers, but meh.

vars.proj.scala-rewrites: ${vars.base} {
  name: "scala-rewrites"
  uri: "https://github.com/scala/scala-rewrites.git#d74c03b5fefa8303f98969b97dbeff290f2d7a59"

  check-missing: false  // allow binary dependencies
  extra.commands: ${vars.base.extra.commands} [
    // these are all tainted, somewhere, by CrossVersion.full
    "removeDependency org.scalameta semanticdb-scalac"
    "removeDependency ch.epfl.scala scalafix-rules"
    "removeDependency ch.epfl.scala scalafix-testkit"
    // exclusions prevent CrossVersion.full transitive dependencies from returning
    """set ThisBuild / libraryDependencies +=                "org.scalameta" %% "scalameta"                 % "4.3.8""""
    """set input     / libraryDependencies += compilerPlugin("org.scalameta" %  "semanticdb-scalac_2.12.11" % "4.3.8")"""
    """set rewrites  / libraryDependencies +=                "ch.epfl.scala" %  "scalafix-rules_2.12"       % "0.9.15"        excludeAll(ExclusionRule(organization = "org.scalameta"))"""
    """set tests     / libraryDependencies +=                "ch.epfl.scala" %  "scalafix-reflect_2.12.11"  % "0.9.15" % Test excludeAll(ExclusionRule(organization = "ch.epfl.scala"))"""
    """set tests     / libraryDependencies +=                "ch.epfl.scala" %  "scalafix-testkit_2.12.11"  % "0.9.15" % Test excludeAll(ExclusionRule(organization = "org.scalameta"), ExclusionRule(organization = "ch.epfl.scala"))"""
  ]
}
